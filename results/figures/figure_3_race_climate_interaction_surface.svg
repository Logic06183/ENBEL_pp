<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 800">
  <defs>
    <!-- Color gradients for heatmap -->
    <linearGradient id="heatmapGradient" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#313695;stop-opacity:1" />
      <stop offset="20%" style="stop-color:#4575b4;stop-opacity:1" />
      <stop offset="40%" style="stop-color:#74add1;stop-opacity:1" />
      <stop offset="60%" style="stop-color:#abd9e9;stop-opacity:1" />
      <stop offset="80%" style="stop-color:#fee090;stop-opacity:1" />
      <stop offset="90%" style="stop-color:#f46d43;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#a50026;stop-opacity:1" />
    </linearGradient>
    
    <!-- 3D effect gradients -->
    <linearGradient id="surface3D1" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#a50026;stop-opacity:0.9" />
      <stop offset="100%" style="stop-color:#8B0000;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="surface3D2" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#f46d43;stop-opacity:0.9" />
      <stop offset="100%" style="stop-color:#D2691E;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="surface3D3" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#74add1;stop-opacity:0.9" />
      <stop offset="100%" style="stop-color:#4682B4;stop-opacity:1" />
    </linearGradient>
    
    <!-- Drop shadows -->
    <filter id="dropshadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="3" dy="3" stdDeviation="3" flood-color="#00000040"/>
    </filter>
    
    <!-- Panel borders -->
    <filter id="panelShadow" x="-10%" y="-10%" width="120%" height="120%">
      <feDropShadow dx="2" dy="2" stdDeviation="4" flood-color="#00000020"/>
    </filter>
  </defs>
  
  <!-- Background -->
  <rect width="1200" height="800" fill="#ffffff"/>
  
  <!-- Main Title -->
  <text x="600" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#2c3e50">
    Figure 3: Race-Climate Interaction Surfaces for Glucose Metabolism
  </text>
  
  <!-- Subtitle -->
  <text x="600" y="50" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#7f8c8d">
    SHAP importance surfaces showing differential climate vulnerability across demographic groups
  </text>
  
  <!-- Panel A: Acute Phase (Lag 1-2) -->
  <g class="panel-a">
    <rect x="50" y="80" width="350" height="280" fill="#f8f9fa" stroke="#dee2e6" stroke-width="2" rx="10" filter="url(#panelShadow)"/>
    <text x="225" y="105" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#2c3e50">
      A. Acute Phase Response (1-2 Days)
    </text>
    
    <!-- 3D surface representation -->
    <g class="surface-3d-acute">
      <!-- Base grid -->
      <g stroke="#bdc3c7" stroke-width="1" opacity="0.3">
        <line x1="80" y1="330" x2="370" y2="330"/>
        <line x1="80" y1="300" x2="370" y2="300"/>
        <line x1="80" y1="270" x2="370" y2="270"/>
        <line x1="80" y1="240" x2="370" y2="240"/>
        <line x1="80" y1="210" x2="370" y2="210"/>
        <line x1="80" y1="180" x2="370" y2="180"/>
        <line x1="80" y1="150" x2="370" y2="150"/>
        
        <line x1="100" y1="140" x2="100" y2="340"/>
        <line x1="150" y1="140" x2="150" y2="340"/>
        <line x1="200" y1="140" x2="200" y2="340"/>
        <line x1="250" y1="140" x2="250" y2="340"/>
        <line x1="300" y1="140" x2="300" y2="340"/>
        <line x1="350" y1="140" x2="350" y2="340"/>
      </g>
      
      <!-- Surface patches with 3D effect -->
      <polygon points="100,280 150,260 200,240 150,300 100,320" fill="url(#surface3D1)" filter="url(#dropshadow)"/>
      <polygon points="150,260 200,240 250,220 200,280 150,300" fill="url(#surface3D1)" filter="url(#dropshadow)"/>
      <polygon points="200,240 250,220 300,200 250,260 200,280" fill="url(#surface3D2)" filter="url(#dropshadow)"/>
      <polygon points="250,220 300,200 350,190 300,240 250,260" fill="url(#surface3D2)" filter="url(#dropshadow)"/>
      
      <!-- Race group labels -->
      <text x="90" y="350" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">Race 4</text>
      <text x="175" y="350" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">Race 5</text>
      <text x="275" y="350" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">Race 11</text>
      
      <!-- Temperature axis -->
      <text x="400" y="240" text-anchor="start" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50" transform="rotate(90 400 240)">
        Temperature (°C)
      </text>
      
      <!-- SHAP importance values -->
      <text x="125" y="275" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="#ffffff">19.8</text>
      <text x="175" y="255" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="#ffffff">15.4</text>
      <text x="225" y="235" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="#ffffff">11.4</text>
    </g>
    
    <!-- Axes labels -->
    <text x="225" y="380" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#2c3e50">
      Racial/Ethnic Groups
    </text>
    <text x="60" y="240" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#2c3e50" transform="rotate(-90 60 240)">
      SHAP Importance
    </text>
  </g>
  
  <!-- Panel B: Chronic Phase (Lag 21) -->
  <g class="panel-b">
    <rect x="450" y="80" width="350" height="280" fill="#f8f9fa" stroke="#dee2e6" stroke-width="2" rx="10" filter="url(#panelShadow)"/>
    <text x="625" y="105" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#2c3e50">
      B. Chronic Phase Response (21 Days)
    </text>
    
    <!-- 3D surface representation -->
    <g class="surface-3d-chronic">
      <!-- Base grid -->
      <g stroke="#bdc3c7" stroke-width="1" opacity="0.3">
        <line x1="480" y1="330" x2="770" y2="330"/>
        <line x1="480" y1="300" x2="770" y2="300"/>
        <line x1="480" y1="270" x2="770" y2="270"/>
        <line x1="480" y1="240" x2="770" y2="240"/>
        <line x1="480" y1="210" x2="770" y2="210"/>
        <line x1="480" y1="180" x2="770" y2="180"/>
        <line x1="480" y1="150" x2="770" y2="150"/>
        
        <line x1="500" y1="140" x2="500" y2="340"/>
        <line x1="550" y1="140" x2="550" y2="340"/>
        <line x1="600" y1="140" x2="600" y2="340"/>
        <line x1="650" y1="140" x2="650" y2="340"/>
        <line x1="700" y1="140" x2="700" y2="340"/>
        <line x1="750" y1="140" x2="750" y2="340"/>
      </g>
      
      <!-- Surface patches showing sustained effects -->
      <polygon points="500,290 550,270 600,260 550,310 500,330" fill="url(#surface3D2)" filter="url(#dropshadow)"/>
      <polygon points="550,270 600,260 650,250 600,290 550,310" fill="url(#surface3D2)" filter="url(#dropshadow)"/>
      <polygon points="600,260 650,250 700,240 650,270 600,290" fill="url(#surface3D3)" filter="url(#dropshadow)"/>
      <polygon points="650,250 700,240 750,230 700,260 650,270" fill="url(#surface3D3)" filter="url(#dropshadow)"/>
      
      <!-- Race group labels -->
      <text x="490" y="350" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">Race 4</text>
      <text x="575" y="350" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">Race 5</text>
      <text x="675" y="350" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">Race 11</text>
      
      <!-- SHAP importance values -->
      <text x="525" y="285" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="#ffffff">18.6</text>
      <text x="575" y="270" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="#ffffff">14.3</text>
      <text x="625" y="255" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="#000000">8.2</text>
    </g>
    
    <!-- Axes labels -->
    <text x="625" y="380" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#2c3e50">
      Racial/Ethnic Groups
    </text>
    <text x="460" y="240" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#2c3e50" transform="rotate(-90 460 240)">
      SHAP Importance
    </text>
  </g>
  
  <!-- Panel C: Interaction Mechanism -->
  <g class="panel-c">
    <rect x="850" y="80" width="320" height="280" fill="#f8f9fa" stroke="#dee2e6" stroke-width="2" rx="10" filter="url(#panelShadow)"/>
    <text x="1010" y="105" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#2c3e50">
      C. Interaction Mechanisms
    </text>
    
    <!-- Conceptual diagram -->
    <g class="mechanism-diagram">
      <!-- Temperature node -->
      <circle cx="950" cy="150" r="30" fill="#e74c3c" filter="url(#dropshadow)"/>
      <text x="950" y="155" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#ffffff">
        Temperature
      </text>
      
      <!-- Race nodes -->
      <circle cx="880" cy="220" r="25" fill="#9b59b6" filter="url(#dropshadow)"/>
      <text x="880" y="225" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="#ffffff">
        Race 4
      </text>
      
      <circle cx="950" cy="220" r="25" fill="#9b59b6" filter="url(#dropshadow)"/>
      <text x="950" y="225" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="#ffffff">
        Race 5
      </text>
      
      <circle cx="1020" cy="220" r="25" fill="#9b59b6" filter="url(#dropshadow)"/>
      <text x="1020" y="225" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="#ffffff">
        Race 11
      </text>
      
      <!-- Glucose outcome -->
      <ellipse cx="950" cy="300" rx="40" ry="25" fill="#f39c12" filter="url(#dropshadow)"/>
      <text x="950" y="305" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#ffffff">
        Glucose
      </text>
      
      <!-- Interaction arrows -->
      <defs>
        <marker id="arrowhead2" markerWidth="8" markerHeight="6" 
                refX="7" refY="3" orient="auto">
          <polygon points="0 0, 8 3, 0 6" fill="#2c3e50" />
        </marker>
      </defs>
      
      <path d="M 930,170 Q 900,190 890,200" stroke="#2c3e50" stroke-width="2" fill="none" marker-end="url(#arrowhead2)"/>
      <path d="M 950,180 L 950,195" stroke="#2c3e50" stroke-width="2" fill="none" marker-end="url(#arrowhead2)"/>
      <path d="M 970,170 Q 1000,190 1010,200" stroke="#2c3e50" stroke-width="2" fill="none" marker-end="url(#arrowhead2)"/>
      
      <path d="M 890,245 Q 910,270 930,285" stroke="#e74c3c" stroke-width="3" fill="none" marker-end="url(#arrowhead2)"/>
      <path d="M 950,245 L 950,275" stroke="#e74c3c" stroke-width="3" fill="none" marker-end="url(#arrowhead2)"/>
      <path d="M 1010,245 Q 990,270 970,285" stroke="#e74c3c" stroke-width="3" fill="none" marker-end="url(#arrowhead2)"/>
      
      <!-- Interaction strength labels -->
      <text x="870" y="265" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#e74c3c" font-weight="bold">
        Strong
      </text>
      <text x="950" y="265" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#f39c12" font-weight="bold">
        Moderate
      </text>
      <text x="1030" y="265" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#3498db" font-weight="bold">
        Weak
      </text>
    </g>
  </g>
  
  <!-- Heatmap Legend -->
  <g class="heatmap-legend">
    <rect x="50" y="400" width="1100" height="80" fill="#f8f9fa" stroke="#dee2e6" stroke-width="2" rx="10" filter="url(#panelShadow)"/>
    <text x="600" y="425" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#2c3e50">
      SHAP Importance Scale
    </text>
    
    <!-- Color scale -->
    <rect x="300" y="440" width="600" height="20" fill="url(#heatmapGradient)" stroke="#2c3e50" stroke-width="1"/>
    
    <!-- Scale labels -->
    <g font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">
      <text x="300" y="475" text-anchor="start">0</text>
      <text x="420" y="475" text-anchor="middle">5</text>
      <text x="540" y="475" text-anchor="middle">10</text>
      <text x="660" y="475" text-anchor="middle">15</text>
      <text x="780" y="475" text-anchor="middle">20</text>
      <text x="900" y="475" text-anchor="end">25+</text>
    </g>
    
    <text x="600" y="470" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#2c3e50">
      Low Impact ← → High Impact
    </text>
  </g>
  
  <!-- Statistical Summary Panel -->
  <g class="stats-panel">
    <rect x="50" y="520" width="1100" height="200" fill="#e8f4fd" stroke="#2196f3" stroke-width="2" rx="10" filter="url(#panelShadow)"/>
    <text x="600" y="545" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#2c3e50">
      Quantitative Race-Climate Interaction Analysis
    </text>
    
    <!-- Three columns of statistics -->
    <g class="stats-col1">
      <text x="80" y="570" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#2c3e50">
        Acute Phase (1-2 Days):
      </text>
      <text x="80" y="585" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">
        • Race 4: Highest vulnerability (SHAP = 19.8)
      </text>
      <text x="80" y="600" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">
        • Race 5: Moderate vulnerability (SHAP = 15.4)
      </text>
      <text x="80" y="615" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">
        • Race 11: Lower vulnerability (SHAP = 11.4)
      </text>
      <text x="80" y="630" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">
        • 73% difference between highest/lowest
      </text>
      
      <text x="80" y="655" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#2c3e50">
        Clinical Implications:
      </text>
      <text x="80" y="670" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">
        • Race-specific glucose monitoring protocols
      </text>
      <text x="80" y="685" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">
        • Targeted early intervention strategies
      </text>
      <text x="80" y="700" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">
        • Health equity-focused climate adaptation
      </text>
    </g>
    
    <g class="stats-col2">
      <text x="420" y="570" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#2c3e50">
        Chronic Phase (21 Days):
      </text>
      <text x="420" y="585" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">
        • Sustained effects across all groups
      </text>
      <text x="420" y="600" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">
        • Race 4: SHAP = 18.6 (persistent high risk)
      </text>
      <text x="420" y="615" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">
        • Cumulative metabolic dysfunction
      </text>
      <text x="420" y="630" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">
        • Long-term health disparities
      </text>
      
      <text x="420" y="655" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#2c3e50">
        Research Priorities:
      </text>
      <text x="420" y="670" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">
        • Genetic susceptibility factors
      </text>
      <text x="420" y="685" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">
        • Socioeconomic mediating pathways
      </text>
      <text x="420" y="700" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">
        • Intervention effectiveness by group
      </text>
    </g>
    
    <g class="stats-col3">
      <text x="760" y="570" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#2c3e50">
        Model Performance:
      </text>
      <text x="760" y="585" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">
        • Overall R² = 0.393 (robust prediction)
      </text>
      <text x="760" y="600" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">
        • Sample size: n = 2,731 participants
      </text>
      <text x="760" y="615" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">
        • Cross-validated performance
      </text>
      <text x="760" y="630" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">
        • Mean absolute SHAP: 8.7
      </text>
      
      <text x="760" y="655" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#2c3e50">
        Translation Impact:
      </text>
      <text x="760" y="670" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">
        • Precision climate medicine framework
      </text>
      <text x="760" y="685" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">
        • Population health surveillance
      </text>
      <text x="760" y="700" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">
        • Policy development guidance
      </text>
    </g>
  </g>
  
  <!-- Footer note -->
  <text x="600" y="760" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#7f8c8d">
    Temperature × Race interactions show strongest effects in Race 4 group with persistent vulnerability across temporal scales
  </text>
  
  <text x="600" y="780" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#7f8c8d">
    Statistical significance: p &lt; 0.001 for all interaction terms | SHAP values represent feature importance magnitudes
  </text>
</svg>